!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.$=t():e.$=t()}(self,(()=>(()=>{var e={527:e=>{e.exports=function e(t,i,r){function s(a,o){if(!i[a]){if(!t[a]){if(n)return n(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var l=i[a]={exports:{}};t[a][0].call(l.exports,(function(e){return s(t[a][1][e]||e)}),l,l.exports,e,t,i,r)}return i[a].exports}for(var n=void 0,a=0;a<r.length;a++)s(r[a]);return s}({1:[function(e,t,i){"use strict";function r(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}function s(e){return e.type===r.Bytes?e.readVarint()+e.pos:e.pos+1}function n(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function a(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.ceil(Math.log(t)/(7*Math.LN2));i.realloc(r);for(var s=i.pos-1;s>=e;s--)i.buf[s+r]=i.buf[s]}function o(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function h(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function l(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function u(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function f(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function c(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function d(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function p(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function y(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function v(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function g(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function _(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}t.exports=r;var w=e("ieee754");r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var x=4294967296,T=1/x;r.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),s=r>>3,n=this.pos;this.type=7&r,e(s,t,this),this.pos===n&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=v(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=_(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=v(this.buf,this.pos)+v(this.buf,this.pos+4)*x;return this.pos+=8,e},readSFixed64:function(){var e=v(this.buf,this.pos)+_(this.buf,this.pos+4)*x;return this.pos+=8,e},readFloat:function(){var e=w.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=w.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,r=this.buf;return t=127&(i=r[this.pos++]),i<128?t:(t|=(127&(i=r[this.pos++]))<<7,i<128?t:(t|=(127&(i=r[this.pos++]))<<14,i<128?t:(t|=(127&(i=r[this.pos++]))<<21,i<128?t:function(e,t,i){var r,s,a=i.buf;if(r=(112&(s=a[i.pos++]))>>4,s<128)return n(e,r,t);if(r|=(127&(s=a[i.pos++]))<<3,s<128)return n(e,r,t);if(r|=(127&(s=a[i.pos++]))<<10,s<128)return n(e,r,t);if(r|=(127&(s=a[i.pos++]))<<17,s<128)return n(e,r,t);if(r|=(127&(s=a[i.pos++]))<<24,s<128)return n(e,r,t);if(r|=(1&(s=a[i.pos++]))<<31,s<128)return n(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=function(e,t,i){for(var r="",s=t;s<i;){var n,a,o,h=e[s],l=null,u=h>239?4:h>223?3:h>191?2:1;if(s+u>i)break;1===u?h<128&&(l=h):2===u?128==(192&(n=e[s+1]))&&(l=(31&h)<<6|63&n)<=127&&(l=null):3===u?(n=e[s+1],a=e[s+2],128==(192&n)&&128==(192&a)&&((l=(15&h)<<12|(63&n)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===u&&(n=e[s+1],a=e[s+2],o=e[s+3],128==(192&n)&&128==(192&a)&&128==(192&o)&&((l=(15&h)<<18|(63&n)<<12|(63&a)<<6|63&o)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,u=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),s+=u}return r}(this.buf,this.pos,e);return this.pos=e,t},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){var i=s(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){var t=s(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){var t=s(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){var t=s(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){var t=s(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){var t=s(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){var t=s(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){var t=s(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){var t=s(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===r.Varint)for(;this.buf[this.pos++]>127;);else if(t===r.Bytes)this.pos=this.readVarint()+this.pos;else if(t===r.Fixed32)this.pos+=4;else{if(t!==r.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),g(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),g(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),g(this.buf,-1&e,this.pos),g(this.buf,Math.floor(e*T),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),g(this.buf,-1&e,this.pos),g(this.buf,Math.floor(e*T),this.pos+4),this.pos+=8},writeVarint:function(e){return(e=+e||0)>268435455||e<0?void function(e,t){var i,r;if(e>=0?(i=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos]=127&e}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),void(e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127)))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var r,s,n=0;n<t.length;n++){if((r=t.charCodeAt(n))>55295&&r<57344){if(!s){r>56319||n+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):s=r;continue}if(r<56320){e[i++]=239,e[i++]=191,e[i++]=189,s=r;continue}r=s-55296<<10|r-56320|65536,s=null}else s&&(e[i++]=239,e[i++]=191,e[i++]=189,s=null);r<128?e[i++]=r:(r<2048?e[i++]=r>>6|192:(r<65536?e[i++]=r>>12|224:(e[i++]=r>>18|240,e[i++]=r>>12&63|128),e[i++]=r>>6&63|128),e[i++]=63&r|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&a(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),w.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),w.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;r>=128&&a(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,i){this.writeTag(e,r.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){this.writeMessage(e,o,t)},writePackedSVarint:function(e,t){this.writeMessage(e,h,t)},writePackedBoolean:function(e,t){this.writeMessage(e,f,t)},writePackedFloat:function(e,t){this.writeMessage(e,l,t)},writePackedDouble:function(e,t){this.writeMessage(e,u,t)},writePackedFixed32:function(e,t){this.writeMessage(e,c,t)},writePackedSFixed32:function(e,t){this.writeMessage(e,d,t)},writePackedFixed64:function(e,t){this.writeMessage(e,p,t)},writePackedSFixed64:function(e,t){this.writeMessage(e,y,t)},writeBytesField:function(e,t){this.writeTag(e,r.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,r.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,r.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,r.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,r.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,r.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,r.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,r.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,r.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,r.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}}},{ieee754:2}],2:[function(e,t,i){i.read=function(e,t,i,r,s){var n,a,o=8*s-r-1,h=(1<<o)-1,l=h>>1,u=-7,f=i?s-1:0,c=i?-1:1,d=e[t+f];for(f+=c,n=d&(1<<-u)-1,d>>=-u,u+=o;u>0;n=256*n+e[t+f],f+=c,u-=8);for(a=n&(1<<-u)-1,n>>=-u,u+=r;u>0;a=256*a+e[t+f],f+=c,u-=8);if(0===n)n=1-l;else{if(n===h)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,r),n-=l}return(d?-1:1)*a*Math.pow(2,n-r)},i.write=function(e,t,i,r,s,n){var a,o,h,l=8*n-s-1,u=(1<<l)-1,f=u>>1,c=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:n-1,p=r?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-a))<1&&(a--,h*=2),(t+=a+f>=1?c/h:c*Math.pow(2,1-f))*h>=2&&(a++,h/=2),a+f>=u?(o=0,a=u):a+f>=1?(o=(t*h-1)*Math.pow(2,s),a+=f):(o=t*Math.pow(2,f-1)*Math.pow(2,s),a=0));s>=8;e[i+d]=255&o,d+=p,o/=256,s-=8);for(a=a<<s|o,l+=s;l>0;e[i+d]=255&a,d+=p,a/=256,l-=8);e[i+d-p]|=128*y}},{}]},{},[1])(1)}},t={};function i(r){var s=t[r];if(void 0!==s)return s.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,i),n.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";i.r(r),i.d(r,{MVTFeature:()=>e,MVTLayer:()=>t,MVTSource:()=>f});class e{constructor(e){this.mVTSource=e.mVTSource,this.selected=e.selected,this.featureId=e.featureId,this.tiles=[],this.style=e.style,this.type=e.vectorTileFeature.type,this.properties=e.vectorTileFeature.properties,this.addTileFeature(e.vectorTileFeature,e.tileContext),this.selected&&this.select()}addTileFeature(e,t){this.tiles[t.id]={vectorTileFeature:e,divisor:e.extent/t.tileSize}}getTiles(){return this.tiles}setStyle(e){this.style=e}redrawTiles(){var e=this.mVTSource.map.getZoom();for(var t in this.tiles)this.mVTSource.deleteTileDrawn(t),this.mVTSource.getTileObject(t).zoom==e&&this.mVTSource.redrawTile(t)}toggle(){this.selected?this.deselect():this.select()}select(){this.selected=!0,this.mVTSource.featureSelected(this),this.redrawTiles()}deselect(){this.selected=!1,this.mVTSource.featureDeselected(this),this.redrawTiles()}setSelected(e){this.selected=e}draw(e){var t=this.tiles[e.id],i=this.style;switch(this.selected&&this.style.selected&&(i=this.style.selected),this.type){case 1:this._drawPoint(e,t,i);break;case 2:this._drawLineString(e,t,i);break;case 3:this._drawPolygon(e,t,i)}}_drawPoint(e,t,i){var r=this._getContext2d(e.canvas,i),s=i.radius||3;r.beginPath();var n=t.vectorTileFeature.coordinates[0][0],a=this._getPoint(n,e,t.divisor);r.arc(a.x,a.y,s,0,2*Math.PI),r.closePath(),r.fill(),r.stroke()}_drawLineString(e,t,i){var r=this._getContext2d(e.canvas,i);this._drawCoordinates(e,r,t),r.stroke()}_drawPolygon(e,t,i){var r=this._getContext2d(e.canvas,i);this._drawCoordinates(e,r,t),r.closePath(),i.fillStyle&&r.fill(),i.strokeStyle&&r.stroke()}_drawCoordinates(e,t,i){t.beginPath();for(var r=i.vectorTileFeature.coordinates,s=0,n=r.length;s<n;s++)for(var a=r[s],o=0,h=a.length;o<h;o++){var l=(0===o?"move":"line")+"To",u=this._getPoint(a[o],e,i.divisor);t[l](u.x,u.y)}}getPaths(e){for(var t=[],i=this.tiles[e.id],r=i.vectorTileFeature.coordinates,s=0,n=r.length;s<n;s++){for(var a=[],o=r[s],h=0,l=o.length;h<l;h++){var u=this._getPoint(o[h],e,i.divisor);a.push(u)}a.length>0&&t.push(a)}return t}_getContext2d(e,t){var i=e.getContext("2d");for(var r in t)"selected"!==r&&(i[r]=t[r]);return i}_getPoint(e,t,i){var r={x:e.x/i,y:e.y/i};return t.parentId&&(r=this._getOverzoomedPoint(r,t)),r}_getOverzoomedPoint(e,t){var i=this.mVTSource.getTileObject(t.parentId),r=this.mVTSource.getTileObject(t.id),s=r.zoom-i.zoom;const n=Math.pow(2,s);let a=e.x*n,o=e.y*n,h=r.x%n,l=r.y%n;return e.x=a-h*t.tileSize,e.y=o-l*t.tileSize,e}}class t{constructor(e){this._lineClickTolerance=2,this._getIDForLayerFeature=e.getIDForLayerFeature,this.style=e.style,this.name=e.name,this._filter=e.filter||!1,this._canvasAndFeatures=[],this._features=[]}parseVectorTileFeatures(e,t,i){this._canvasAndFeatures[i.id]={canvas:i.canvas,features:[]};for(var r=0,s=t.length;r<s;r++){var n=t[r];this._parseVectorTileFeature(e,n,i,r)}this.drawTile(i)}_parseVectorTileFeature(t,i,r,s){if(!this._filter||"function"!=typeof this._filter||!1!==this._filter(i,r)){var n=this.getStyle(i),a=this._getIDForLayerFeature(i)||s,o=this._features[a];if(o)o.setStyle(n),o.addTileFeature(i,r);else{var h=t.isFeatureSelected(a);o=new e({mVTSource:t,vectorTileFeature:i,tileContext:r,style:n,selected:h,featureId:a}),this._features[a]=o}this._canvasAndFeatures[r.id].features.push(o)}}drawTile(e){var t=this._canvasAndFeatures[e.id].features;if(t){for(var i=[],r=0,s=t.length;r<s;r++){var n=t[r];n.selected?i.push(n):n.draw(e)}for(r=0,s=i.length;r<s;r++)i[r].draw(e)}}getCanvas(e){return this._canvasAndFeatures[e].canvas}getStyle(e){return"function"==typeof this.style?this.style(e):this.style}setStyle(e){for(var t in this.style=e,this._features)this._features[t].setStyle(e)}setSelected(e){void 0!==this._features[e]&&this._features[e].select()}setFilter(e){this._filter=e}handleClickEvent(e){var t=this._canvasAndFeatures[e.tileContext.id];if(!t)return e;var i=t.canvas,r=t.features;return i&&r?(e.feature=this._handleClickGetFeature(e,r),e):e}_handleClickGetFeature(e,t){for(var i=Number.POSITIVE_INFINITY,r=null,s=t.length-1;s>=0;s--)for(var n=t[s],a=n.getPaths(e.tileContext),o=a.length-1;o>=0;o--){var h=a[o];switch(n.type){case 1:MERCATOR.in_circle(h[0].x,h[0].y,n.style.radius,e.tilePoint.x,e.tilePoint.y)&&(r=n,i=0);break;case 2:var l=MERCATOR.getDistanceFromLine(e.tilePoint,h);l<(n.selected&&n.style.selected?n.style.selected.lineWidth:n.style.lineWidth)/2+this._lineClickTolerance&&l<i&&(r=n,i=l);break;case 3:MERCATOR.isPointInPolygon(e.tilePoint,h)&&(r=n,i=0)}if(0==i)return r}return r}}var s=i(527),n=i.n(s);const a={fromLatLngToPoint:function(e){var t=Math.min(Math.max(Math.sin(e.lat()*(Math.PI/180)),-.9999),.9999);return{x:128+e.lng()*(256/360),y:128+.5*Math.log((1+t)/(1-t))*(-256/(2*Math.PI))}},fromPointToLatLng:function(e){return{lat:(2*Math.atan(Math.exp((e.y-128)/(-256/(2*Math.PI))))-Math.PI/2)/(Math.PI/180),lng:(e.x-128)/(256/360)}},getTileAtLatLng:function(e,t){var i=256/Math.pow(2,t),r=this.fromLatLngToPoint(e);return{x:Math.floor(r.x/i),y:Math.floor(r.y/i),z:t}},getTileBounds:function(e){e=this.normalizeTile(e);var t=256/Math.pow(2,e.z),i={x:e.x*t,y:e.y*t+t},r={x:e.x*t+t,y:e.y*t};return{sw:this.fromPointToLatLng(i),ne:this.fromPointToLatLng(r)}},normalizeTile:function(e){var t=Math.pow(2,e.z);return e.x=(e.x%t+t)%t,e.y=(e.y%t+t)%t,e},fromLatLngToPixels:function(e,t){var i=e.getBounds(),r=i.getNorthEast(),s=i.getSouthWest(),n=e.getProjection().fromLatLngToPoint(r),a=e.getProjection().fromLatLngToPoint(s),o=Math.pow(2,e.getZoom()),h=e.getProjection().fromLatLngToPoint(t);return{x:(h.x-a.x)*o,y:(h.y-n.y)*o}},fromLatLngToTilePoint:function(e,t){var i=e.getZoom(),r=this.getTileAtLatLng(t.latLng,i),s=this.getTileBounds(r),n=new google.maps.LatLng(s.sw),a=new google.maps.LatLng(s.ne),o=this.fromLatLngToPixels(e,n),h=this.fromLatLngToPixels(e,a);return{x:t.pixel.x-o.x,y:t.pixel.y-h.y}},isPointInPolygon:function(e,t){if(t&&t.length){for(var i=!1,r=-1,s=t.length,n=s-1;++r<s;n=r)(t[r].y<=e.y&&e.y<t[n].y||t[n].y<=e.y&&e.y<t[r].y)&&e.x<(t[n].x-t[r].x)*(e.y-t[r].y)/(t[n].y-t[r].y)+t[r].x&&(i=!i);return i}},in_circle:function(e,t,i,r,s){return Math.pow(e-r,2)+Math.pow(t-s,2)<=Math.pow(i,2)},getDistanceFromLine:function(e,t){var i=Number.POSITIVE_INFINITY;if(t&&t.length>1)for(var r=0,s=t.length-1;r<s;r++){var n=this.projectPointOnLineSegment(e,t[r],t[r+1]);n<=i&&(i=n)}return i},projectPointOnLineSegment:function(e,t,i){var r,s,n=e.x,a=e.y,o=t.x,h=t.y,l=i.x,u=i.y,f=l-o,c=u-h,d=f*f+c*c,p=-1;0!=d&&(p=((n-o)*f+(a-h)*c)/d),p<0?(r=o,s=h):p>1?(r=l,s=u):(r=o+p*f,s=h+p*c);var y=n-r,v=a-s;return Math.sqrt(y*y+v*v)}};function o(e,t){this.x=e,this.y=t}function h(e,t,i,r,s){for(this.properties={},this.extent=i,this.type=0,this._buffer=e,this._geometry=-1,t=t||e.length;e.pos<t;){var n=e.readVarint(),a=n>>3;if(1==a)this._id=e.readVarint();else if(2==a)for(var o=e.readVarint(),h=e.pos+o;e.pos<h;){var l=r[e.readVarint()],u=s[e.readVarint()];this.properties[l]=u}else 3==a?this.type=e.readVarint():4==a?(this._geometry=e.pos,e.skip(n)):e.skip(n)}}function l(e,t){var i,r;for(this.version=1,this.name=null,this.extent=4096,this.length=0,this._buffer=e,this._keys=[],this._values=[],this._features=[],t=t||e.length;e.pos<t;)15==(r=(i=e.readVarint())>>3)?this.version=e.readVarint():1===r?this.name=e.readString():5===r?this.extent=e.readVarint():2===r?(this.length++,this._features.push(e.pos),e.skip(i)):3===r?this._keys.push(e.readString()):4===r?this._values.push(this.readFeatureValue()):e.skip(i)}function u(e,t){for(this.layers={},this._buffer=e,t=t||e.length;e.pos<t;){var i=e.readVarint();if(3==i>>3){var r=this._readLayer();r.length&&(this.layers[r.name]=r)}else e.skip(i)}this.parseGeometries()}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,i=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),r=t*this.x-i*this.y,s=i*this.x+t*this.y;return this.x=r,this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(e){return e instanceof o?e:Array.isArray(e)?new o(e[0],e[1]):e},h.types=["Unknown","Point","LineString","Polygon"],h.prototype.loadGeometry=function(){var e=this._buffer;e.pos=this._geometry;for(var t,i=e.readVarint(),r=e.pos+i,s=1,n=0,a=0,h=0,l=[];e.pos<r;){if(!n){var u=e.readVarint();s=7&u,n=u>>3}if(n--,1===s||2===s)a+=e.readSVarint(),h+=e.readSVarint(),1===s&&(t&&l.push(t),t=[]),t.push(new o(a,h));else{if(7!==s)throw new Error("unknown command "+s);t.push(t[0].clone())}}return t&&l.push(t),l},h.prototype.bbox=function(){var e=this._buffer;e.pos=this._geometry;for(var t=e.readVarint(),i=e.pos+t,r=1,s=0,n=0,a=0,o=1/0,h=-1/0,l=1/0,u=-1/0;e.pos<i;){if(!s){var f=e.readVarint();r=7&f,s=f>>3}if(s--,1===r||2===r)(n+=e.readSVarint())<o&&(o=n),n>h&&(h=n),(a+=e.readSVarint())<l&&(l=a),a>u&&(u=a);else if(7!==r)throw new Error("unknown command "+r)}return[o,l,h,u]},l.prototype.readFeatureValue=function(){for(var e,t,i=this._buffer,r=null,s=i.readVarint(),n=i.pos+s;i.pos<n;)1==(t=(e=i.readVarint())>>3)?r=i.readString():2==t?r=i.readFloat():3==t?r=i.readDouble():4==t||5==t?r=i.readVarint():6==t?r=i.readSVarint():7==t?r=Boolean(i.readVarint()):i.skip(e);return r},l.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._buffer.pos=this._features[e];var t=this._buffer.readVarint()+this._buffer.pos;return new h(this._buffer,t,this.extent,this._keys,this._values)},u.prototype._readLayer=function(){var e=this._buffer,t=e.readVarint(),i=e.pos+t,r=new l(e,i);return e.pos=i,r},u.prototype.parseGeometries=function(){for(var e in this.layers){var t=this.layers[e];t.parsedFeatures=[];for(var i=0,r=t._features.length;i<r;i++){var s=t.feature(i);s.coordinates=s.loadGeometry(),t.parsedFeatures.push(s)}}};class f{constructor(e,t){var i=this;this.map=e,this._url=t.url||"",this._sourceMaxZoom=t.sourceMaxZoom||!1,this._debug=t.debug||!1,this.getIDForLayerFeature=t.getIDForLayerFeature||function(e){return e.properties.id||e.properties.Id||e.properties.ID},this._visibleLayers=t.visibleLayers||!1,this._xhrHeaders=t.xhrHeaders||{},this._clickableLayers=t.clickableLayers||!1,this._filter=t.filter||!1,this._cache=t.cache||!1,this._tileSize=t.tileSize||256,this.tileSize=new google.maps.Size(this._tileSize,this._tileSize),this.style=t.style||function(e){var t={};switch(e.type){case 1:t.fillStyle="rgba(49,79,79,1)",t.radius=5,t.selected={fillStyle:"rgba(255,255,0,0.5)",radius:6};break;case 2:t.strokeStyle="rgba(136, 86, 167, 1)",t.lineWidth=3,t.selected={strokeStyle:"rgba(255,25,0,0.5)",lineWidth:4};break;case 3:t.fillStyle="rgba(188, 189, 220, 0.5)",t.strokeStyle="rgba(136, 86, 167, 1)",t.lineWidth=1,t.selected={fillStyle:"rgba(255,140,0,0.3)",strokeStyle:"rgba(255,140,0,1)",lineWidth:2}}return t},this.mVTLayers=[],this._tilesDrawn=[],this._visibleTiles=[],this._selectedFeatures=[],t.selectedFeatures&&this.setSelectedFeatures(t.selectedFeatures),this.map.addListener("zoom_changed",(()=>{i._zoomChanged()}))}getTile(e,t,i){var r=this.drawTile(e,t,i);return this._setVisibleTile(r),r.canvas}releaseTile(e){}_zoomChanged(){this._resetVisibleTiles(),this._cache||this._resetMVTLayers()}_resetMVTLayers(){this.mVTLayers=[]}_deleteVisibleTile(e){delete this._visibleTiles[e]}_resetVisibleTiles(){this._visibleTiles=[]}_setVisibleTile(e){this._visibleTiles[e.id]=e}drawTile(e,t,i){var r=this.getTileId(t,e.x,e.y),s=this._tilesDrawn[r];return s||(s=this._createTileContext(e,t,i),this._xhrRequest(s),s)}_createTileContext(e,t,i){var r=this.getTileId(t,e.x,e.y),s=this._createCanvas(i,r),n=this._getParentId(r);return{id:r,canvas:s,zoom:t,tileSize:this._tileSize,parentId:n}}_getParentId(e){var t=!1;if(this._sourceMaxZoom){var i=this.getTileObject(e);if(i.zoom>this._sourceMaxZoom){var r=i.zoom-this._sourceMaxZoom,s=i.zoom-r,n=i.x>>r,a=i.y>>r;t=this.getTileId(s,n,a)}}return t}_createCanvas(e,t){const i=e.createElement("canvas");return i.width=this._tileSize,i.height=this._tileSize,i.id=t,i}getTileId(e,t,i){return[e,t,i].join(":")}getTileObject(e){var t=e.split(":");return{zoom:t[0],x:t[1],y:t[2]}}_xhrRequest(e){var t=this,i=e.parentId||e.id,r=this.getTileObject(i),s=this._url.replace("{z}",r.zoom).replace("{x}",r.x).replace("{y}",r.y),n=new XMLHttpRequest;for(var a in n.onload=function(){if("200"==n.status&&n.response)return t._xhrResponseOk(e,n.response);t._drawDebugInfo(e)},n.open("GET",s,!0),this._xhrHeaders)n.setRequestHeader(a,this._xhrHeaders[a]);n.responseType="arraybuffer",n.send()}_xhrResponseOk(e,t){if(this.map.getZoom()==e.zoom){var i=new Uint8Array(t),r=new u(new(n())(i));this._drawVectorTile(r,e)}}_setTileDrawn(e){this._cache&&(this._tilesDrawn[e.id]=e)}deleteTileDrawn(e){delete this._tilesDrawn[e]}_resetTileDrawn(){this._tilesDrawn=[]}_drawVectorTile(e,t){if(this._visibleLayers)for(var i=0,r=this._visibleLayers.length;i<r;i++){var s=this._visibleLayers[i];if(e.layers[s]){var n=e.layers[s];this._drawVectorTileLayer(n,s,t)}}else for(var s in e.layers)n=e.layers[s],this._drawVectorTileLayer(n,s,t);t.vectorTile=e,this._drawDebugInfo(t),this._setTileDrawn(t)}_drawVectorTileLayer(e,t,i){this.mVTLayers[t]||(this.mVTLayers[t]=this._createMVTLayer(t)),this.mVTLayers[t].parseVectorTileFeatures(this,e.parsedFeatures,i)}_createMVTLayer(e){var i={getIDForLayerFeature:this.getIDForLayerFeature,filter:this._filter,style:this.style,name:e};return new t(i)}_drawDebugInfo(e){if(this._debug){var t=this.getTileObject(e.id),i=this._tileSize,r=this._tileSize,s=e.canvas.getContext("2d");s.strokeStyle="#000000",s.fillStyle="#FFFF00",s.strokeRect(0,0,i,r),s.font="12px Arial",s.fillRect(0,0,5,5),s.fillRect(0,r-5,5,5),s.fillRect(i-5,0,5,5),s.fillRect(i-5,r-5,5,5),s.fillRect(i/2-5,r/2-5,10,10),s.strokeText(e.zoom+" "+t.x+" "+t.y,i/2-30,r/2-10)}}onClick(e,t,i){this._multipleSelection=i&&i.multipleSelection||!1,i=this._getMouseOptions(i,!1),this._mouseEvent(e,t,i)}onMouseHover(e,t,i){this._multipleSelection=!1,i=this._getMouseOptions(i,!0),this._mouseEvent(e,t,i)}_getMouseOptions(e,t){return{mouseHover:t,setSelected:e.setSelected||!1,toggleSelection:void 0===e.toggleSelection||e.toggleSelection,limitToFirstVisibleLayer:e.limitToFirstVisibleLayer||!1}}_mouseEvent(e,t,i){if(e.pixel&&e.latLng){t=t||function(){};var r=i.limitToFirstVisibleLayer||!1,s=this.map.getZoom(),n=a.getTileAtLatLng(e.latLng,s),o=this.getTileId(n.z,n.x,n.y),h=this._visibleTiles[o];if(h){e.tileContext=h,e.tilePoint=a.fromLatLngToTilePoint(this.map,e);for(var l=this._clickableLayers||Object.keys(this.mVTLayers)||[],u=l.length-1;u>=0;u--){var f=l[u],c=this.mVTLayers[f];if(c&&(e=c.handleClickEvent(e),this._mouseSelectedFeature(e,t,i),r&&e.feature))break}}}}_mouseSelectedFeature(e,t,i){if(i.setSelected){var r=e.feature;r?i.mouseHover?r.selected||r.select():i.toggleSelection?r.toggle():r.selected||r.select():i.mouseHover&&this.deselectAllFeatures()}t(e)}deselectAllFeatures(){var e=this.map.getZoom(),t=[];for(var i in this._selectedFeatures){var r=this._selectedFeatures[i];if(r){r.setSelected(!1);var s=r.getTiles();for(var n in s)this.deleteTileDrawn(n),this.getTileObject(n).zoom==e&&(t[n]=!0)}}this.redrawTiles(t),this._selectedFeatures=[]}featureSelected(e){this._multipleSelection||this.deselectAllFeatures(),this._selectedFeatures[e.featureId]=e}featureDeselected(e){delete this._selectedFeatures[e.featureId]}setSelectedFeatures(e){e.length>1&&(this._multipleSelection=!0),this.deselectAllFeatures();for(var t=0,i=e.length;t<i;t++){var r=e[t];for(var s in this._selectedFeatures[r]=!1,this.mVTLayers)this.mVTLayers[s].setSelected(r)}}isFeatureSelected(e){return null!=this._selectedFeatures[e]}getSelectedFeatures(){var e=[];for(var t in this._selectedFeatures)e.push(this._selectedFeatures[t]);return e}setFilter(e,t){for(var i in t=void 0===t||t,this._filter=e,this.mVTLayers)this.mVTLayers[i].setFilter(e);t&&this.redrawAllTiles()}setStyle(e,t){for(var i in t=void 0===t||t,this.style=e,this.mVTLayers)this.mVTLayers[i].setStyle(e);t&&this.redrawAllTiles()}setVisibleLayers(e,t){t=void 0===t||t,this._visibleLayers=e,t&&this.redrawAllTiles()}getVisibleLayers(){return this._visibleLayers}setClickableLayers(e){this._clickableLayers=e}redrawAllTiles(){this._resetTileDrawn(),this.redrawTiles(this._visibleTiles)}redrawTiles(e){for(var t in e)this.redrawTile(t)}redrawTile(e){this.deleteTileDrawn(e);var t=this._visibleTiles[e];t&&t.vectorTile&&(this.clearTile(t.canvas),this._drawVectorTile(t.vectorTile,t))}clearTile(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}setUrl(e,t){t=void 0===t||t,this._url=e,this._resetMVTLayers(),t&&this.redrawAllTiles()}}})(),r})()));