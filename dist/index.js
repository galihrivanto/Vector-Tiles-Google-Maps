!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.$=e():t.$=e()}(self,(()=>(()=>{var t={527:t=>{t.exports=function t(e,i,r){function s(a,o){if(!i[a]){if(!e[a]){if(n)return n(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var l=i[a]={exports:{}};e[a][0].call(l.exports,(function(t){return s(e[a][1][t]||t)}),l,l.exports,t,e,i,r)}return i[a].exports}for(var n=void 0,a=0;a<r.length;a++)s(r[a]);return s}({1:[function(t,e,i){"use strict";function r(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}function s(t){return t.type===r.Bytes?t.readVarint()+t.pos:t.pos+1}function n(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function a(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var s=i.pos-1;s>=t;s--)i.buf[s+r]=i.buf[s]}function o(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function h(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function l(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function u(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function f(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function c(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function d(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function p(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function y(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function v(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function g(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function _(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}e.exports=r;var w=t("ieee754");r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var x=4294967296,T=1/x;r.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),s=r>>3,n=this.pos;this.type=7&r,t(s,e,this),this.pos===n&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=v(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=_(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=v(this.buf,this.pos)+v(this.buf,this.pos+4)*x;return this.pos+=8,t},readSFixed64:function(){var t=v(this.buf,this.pos)+_(this.buf,this.pos+4)*x;return this.pos+=8,t},readFloat:function(){var t=w.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=w.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(t,e,i){var r,s,a=i.buf;if(r=(112&(s=a[i.pos++]))>>4,s<128)return n(t,r,e);if(r|=(127&(s=a[i.pos++]))<<3,s<128)return n(t,r,e);if(r|=(127&(s=a[i.pos++]))<<10,s<128)return n(t,r,e);if(r|=(127&(s=a[i.pos++]))<<17,s<128)return n(t,r,e);if(r|=(127&(s=a[i.pos++]))<<24,s<128)return n(t,r,e);if(r|=(1&(s=a[i.pos++]))<<31,s<128)return n(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,i){for(var r="",s=e;s<i;){var n,a,o,h=t[s],l=null,u=h>239?4:h>223?3:h>191?2:1;if(s+u>i)break;1===u?h<128&&(l=h):2===u?128==(192&(n=t[s+1]))&&(l=(31&h)<<6|63&n)<=127&&(l=null):3===u?(n=t[s+1],a=t[s+2],128==(192&n)&&128==(192&a)&&((l=(15&h)<<12|(63&n)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===u&&(n=t[s+1],a=t[s+2],o=t[s+3],128==(192&n)&&128==(192&a)&&128==(192&o)&&((l=(15&h)<<18|(63&n)<<12|(63&a)<<6|63&o)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,u=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),s+=u}return r}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var i=s(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===r.Varint)for(;this.buf[this.pos++]>127;);else if(e===r.Bytes)this.pos=this.readVarint()+this.pos;else if(e===r.Fixed32)this.pos+=4;else{if(e!==r.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),g(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),g(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),g(this.buf,-1&t,this.pos),g(this.buf,Math.floor(t*T),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),g(this.buf,-1&t,this.pos),g(this.buf,Math.floor(t*T),this.pos+4),this.pos+=8},writeVarint:function(t){return(t=+t||0)>268435455||t<0?void function(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos]=127&t}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),void(t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127)))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var r,s,n=0;n<e.length;n++){if((r=e.charCodeAt(n))>55295&&r<57344){if(!s){r>56319||n+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):s=r;continue}if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,s=r;continue}r=s-55296<<10|r-56320|65536,s=null}else s&&(t[i++]=239,t[i++]=191,t[i++]=189,s=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&a(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),w.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),w.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&a(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,r.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){this.writeMessage(t,o,e)},writePackedSVarint:function(t,e){this.writeMessage(t,h,e)},writePackedBoolean:function(t,e){this.writeMessage(t,f,e)},writePackedFloat:function(t,e){this.writeMessage(t,l,e)},writePackedDouble:function(t,e){this.writeMessage(t,u,e)},writePackedFixed32:function(t,e){this.writeMessage(t,c,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,d,e)},writePackedFixed64:function(t,e){this.writeMessage(t,p,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,y,e)},writeBytesField:function(t,e){this.writeTag(t,r.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,r.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,r.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,r.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},{ieee754:2}],2:[function(t,e,i){i.read=function(t,e,i,r,s){var n,a,o=8*s-r-1,h=(1<<o)-1,l=h>>1,u=-7,f=i?s-1:0,c=i?-1:1,d=t[e+f];for(f+=c,n=d&(1<<-u)-1,d>>=-u,u+=o;u>0;n=256*n+t[e+f],f+=c,u-=8);for(a=n&(1<<-u)-1,n>>=-u,u+=r;u>0;a=256*a+t[e+f],f+=c,u-=8);if(0===n)n=1-l;else{if(n===h)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,r),n-=l}return(d?-1:1)*a*Math.pow(2,n-r)},i.write=function(t,e,i,r,s,n){var a,o,h,l=8*n-s-1,u=(1<<l)-1,f=u>>1,c=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:n-1,p=r?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,a=u):(a=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-a))<1&&(a--,h*=2),(e+=a+f>=1?c/h:c*Math.pow(2,1-f))*h>=2&&(a++,h/=2),a+f>=u?(o=0,a=u):a+f>=1?(o=(e*h-1)*Math.pow(2,s),a+=f):(o=e*Math.pow(2,f-1)*Math.pow(2,s),a=0));s>=8;t[i+d]=255&o,d+=p,o/=256,s-=8);for(a=a<<s|o,l+=s;l>0;t[i+d]=255&a,d+=p,a/=256,l-=8);t[i+d-p]|=128*y}},{}]},{},[1])(1)}},e={};function i(r){var s=e[r];if(void 0!==s)return s.exports;var n=e[r]={exports:{}};return t[r](n,n.exports,i),n.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return(()=>{"use strict";i.r(r),i.d(r,{MVTFeature:()=>t,MVTLayer:()=>e,MVTSource:()=>f});class t{constructor(t){this.mVTSource=t.mVTSource,this.selected=t.selected,this.featureId=t.featureId,this.tiles=[],this.style=t.style,this.type=t.vectorTileFeature.type,this.properties=t.vectorTileFeature.properties,this.addTileFeature(t.vectorTileFeature,t.tileContext),this.selected&&this.select()}addTileFeature(t,e){this.tiles[e.id]={vectorTileFeature:t,divisor:t.extent/e.tileSize}}getTiles(){return this.tiles}setStyle(t){this.style=t}redrawTiles(){var t=this.mVTSource.map.getZoom();for(var e in this.tiles)this.mVTSource.deleteTileDrawn(e),this.mVTSource.getTileObject(e).zoom==t&&this.mVTSource.redrawTile(e)}toggle(){this.selected?this.deselect():this.select()}select(){this.selected=!0,this.mVTSource.featureSelected(this),this.redrawTiles()}deselect(){this.selected=!1,this.mVTSource.featureDeselected(this),this.redrawTiles()}setSelected(t){this.selected=t}draw(t){var e=this.tiles[t.id],i=this.style;switch(this.selected&&this.style.selected&&(i=this.style.selected),this.type){case 1:this._drawPoint(t,e,i);break;case 2:this._drawLineString(t,e,i);break;case 3:this._drawPolygon(t,e,i)}}_drawPoint(t,e,i){var r=this._getContext2d(t.canvas,i),s=i.radius||3;r.beginPath();var n=e.vectorTileFeature.coordinates[0][0],a=this._getPoint(n,t,e.divisor);r.arc(a.x,a.y,s,0,2*Math.PI),r.closePath(),r.fill(),r.stroke()}_drawLineString(t,e,i){var r=this._getContext2d(t.canvas,i);this._drawCoordinates(t,r,e),r.stroke()}_drawPolygon(t,e,i){var r=this._getContext2d(t.canvas,i);this._drawCoordinates(t,r,e),r.closePath(),i.fillStyle&&r.fill(),i.strokeStyle&&r.stroke()}_drawCoordinates(t,e,i){e.beginPath();for(var r=i.vectorTileFeature.coordinates,s=0,n=r.length;s<n;s++)for(var a=r[s],o=0,h=a.length;o<h;o++){var l=(0===o?"move":"line")+"To",u=this._getPoint(a[o],t,i.divisor);e[l](u.x,u.y)}}getPaths(t){for(var e=[],i=this.tiles[t.id],r=i.vectorTileFeature.coordinates,s=0,n=r.length;s<n;s++){for(var a=[],o=r[s],h=0,l=o.length;h<l;h++){var u=this._getPoint(o[h],t,i.divisor);a.push(u)}a.length>0&&e.push(a)}return e}_getContext2d(t,e){var i=t.getContext("2d");for(var r in e)"selected"!==r&&(i[r]=e[r]);return i}_getPoint(t,e,i){var r={x:t.x/i,y:t.y/i};return e.parentId&&(r=this._getOverzoomedPoint(r,e)),r}_getOverzoomedPoint(t,e){var i=this.mVTSource.getTileObject(e.parentId),r=this.mVTSource.getTileObject(e.id),s=r.zoom-i.zoom;const n=Math.pow(2,s);let a=t.x*n,o=t.y*n,h=r.x%n,l=r.y%n;return t.x=a-h*e.tileSize,t.y=o-l*e.tileSize,t}}class e{constructor(t){this._lineClickTolerance=2,this._getIDForLayerFeature=t.getIDForLayerFeature,this.style=t.style,this.name=t.name,this._filter=t.filter||!1,this._canvasAndFeatures=[],this._features=[]}parseVectorTileFeatures(t,e,i){this._canvasAndFeatures[i.id]={canvas:i.canvas,features:[]};for(var r=0,s=e.length;r<s;r++){var n=e[r];this._parseVectorTileFeature(t,n,i,r)}this.drawTile(i)}_parseVectorTileFeature(e,i,r,s){if(!this._filter||"function"!=typeof this._filter||!1!==this._filter(i,r)){var n=this.getStyle(i),a=this._getIDForLayerFeature(i)||s,o=this._features[a];if(o)o.setStyle(n),o.addTileFeature(i,r);else{var h=e.isFeatureSelected(a);o=new t({mVTSource:e,vectorTileFeature:i,tileContext:r,style:n,selected:h,featureId:a}),this._features[a]=o}this._canvasAndFeatures[r.id].features.push(o)}}drawTile(t){var e=this._canvasAndFeatures[t.id].features;if(e){for(var i=[],r=0,s=e.length;r<s;r++){var n=e[r];n.selected?i.push(n):n.draw(t)}for(r=0,s=i.length;r<s;r++)i[r].draw(t)}}getCanvas(t){return this._canvasAndFeatures[t].canvas}getStyle(t){return"function"==typeof this.style?this.style(t):this.style}setStyle(t){for(var e in this.style=t,this._features)this._features[e].setStyle(t)}setSelected(t){void 0!==this._features[t]&&this._features[t].select()}setFilter(t){this._filter=t}handleClickEvent(t){var e=this._canvasAndFeatures[t.tileContext.id];if(!e)return t;var i=e.canvas,r=e.features;return i&&r?(t.feature=this._handleClickGetFeature(t,r),t):t}_handleClickGetFeature(t,e){for(var i=Number.POSITIVE_INFINITY,r=null,s=e.length-1;s>=0;s--)for(var n=e[s],a=n.getPaths(t.tileContext),o=a.length-1;o>=0;o--){var h=a[o];switch(n.type){case 1:MERCATOR.in_circle(h[0].x,h[0].y,n.style.radius,t.tilePoint.x,t.tilePoint.y)&&(r=n,i=0);break;case 2:var l=MERCATOR.getDistanceFromLine(t.tilePoint,h);l<(n.selected&&n.style.selected?n.style.selected.lineWidth:n.style.lineWidth)/2+this._lineClickTolerance&&l<i&&(r=n,i=l);break;case 3:MERCATOR.isPointInPolygon(t.tilePoint,h)&&(r=n,i=0)}if(0==i)return r}return r}}var s=i(527),n=i.n(s);const a={fromLatLngToPoint:function(t){var e=Math.min(Math.max(Math.sin(t.lat()*(Math.PI/180)),-.9999),.9999);return{x:128+t.lng()*(256/360),y:128+.5*Math.log((1+e)/(1-e))*(-256/(2*Math.PI))}},fromPointToLatLng:function(t){return{lat:(2*Math.atan(Math.exp((t.y-128)/(-256/(2*Math.PI))))-Math.PI/2)/(Math.PI/180),lng:(t.x-128)/(256/360)}},getTileAtLatLng:function(t,e){var i=256/Math.pow(2,e),r=this.fromLatLngToPoint(t);return{x:Math.floor(r.x/i),y:Math.floor(r.y/i),z:e}},getTileBounds:function(t){t=this.normalizeTile(t);var e=256/Math.pow(2,t.z),i={x:t.x*e,y:t.y*e+e},r={x:t.x*e+e,y:t.y*e};return{sw:this.fromPointToLatLng(i),ne:this.fromPointToLatLng(r)}},normalizeTile:function(t){var e=Math.pow(2,t.z);return t.x=(t.x%e+e)%e,t.y=(t.y%e+e)%e,t},fromLatLngToPixels:function(t,e){var i=t.getBounds(),r=i.getNorthEast(),s=i.getSouthWest(),n=t.getProjection().fromLatLngToPoint(r),a=t.getProjection().fromLatLngToPoint(s),o=Math.pow(2,t.getZoom()),h=t.getProjection().fromLatLngToPoint(e);return{x:(h.x-a.x)*o,y:(h.y-n.y)*o}},fromLatLngToTilePoint:function(t,e){var i=t.getZoom(),r=this.getTileAtLatLng(e.latLng,i),s=this.getTileBounds(r),n=new google.maps.LatLng(s.sw),a=new google.maps.LatLng(s.ne),o=this.fromLatLngToPixels(t,n),h=this.fromLatLngToPixels(t,a);return{x:e.pixel.x-o.x,y:e.pixel.y-h.y}},isPointInPolygon:function(t,e){if(e&&e.length){for(var i=!1,r=-1,s=e.length,n=s-1;++r<s;n=r)(e[r].y<=t.y&&t.y<e[n].y||e[n].y<=t.y&&t.y<e[r].y)&&t.x<(e[n].x-e[r].x)*(t.y-e[r].y)/(e[n].y-e[r].y)+e[r].x&&(i=!i);return i}},in_circle:function(t,e,i,r,s){return Math.pow(t-r,2)+Math.pow(e-s,2)<=Math.pow(i,2)},getDistanceFromLine:function(t,e){var i=Number.POSITIVE_INFINITY;if(e&&e.length>1)for(var r=0,s=e.length-1;r<s;r++){var n=this.projectPointOnLineSegment(t,e[r],e[r+1]);n<=i&&(i=n)}return i},projectPointOnLineSegment:function(t,e,i){var r,s,n=t.x,a=t.y,o=e.x,h=e.y,l=i.x,u=i.y,f=l-o,c=u-h,d=f*f+c*c,p=-1;0!=d&&(p=((n-o)*f+(a-h)*c)/d),p<0?(r=o,s=h):p>1?(r=l,s=u):(r=o+p*f,s=h+p*c);var y=n-r,v=a-s;return Math.sqrt(y*y+v*v)}};function o(t,e){this.x=t,this.y=e}function h(t,e,i,r,s){for(this.properties={},this.extent=i,this.type=0,this._buffer=t,this._geometry=-1,e=e||t.length;t.pos<e;){var n=t.readVarint(),a=n>>3;if(1==a)this._id=t.readVarint();else if(2==a)for(var o=t.readVarint(),h=t.pos+o;t.pos<h;){var l=r[t.readVarint()],u=s[t.readVarint()];this.properties[l]=u}else 3==a?this.type=t.readVarint():4==a?(this._geometry=t.pos,t.skip(n)):t.skip(n)}}function l(t,e){var i,r;for(this.version=1,this.name=null,this.extent=4096,this.length=0,this._buffer=t,this._keys=[],this._values=[],this._features=[],e=e||t.length;t.pos<e;)15==(r=(i=t.readVarint())>>3)?this.version=t.readVarint():1===r?this.name=t.readString():5===r?this.extent=t.readVarint():2===r?(this.length++,this._features.push(t.pos),t.skip(i)):3===r?this._keys.push(t.readString()):4===r?this._values.push(this.readFeatureValue()):t.skip(i)}function u(t,e){for(this.layers={},this._buffer=t,e=e||t.length;t.pos<e;){var i=t.readVarint();if(3==i>>3){var r=this._readLayer();r.length&&(this.layers[r.name]=r)}else t.skip(i)}this.parseGeometries()}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=e*this.x-i*this.y,s=i*this.x+e*this.y;return this.x=r,this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(t){return t instanceof o?t:Array.isArray(t)?new o(t[0],t[1]):t},h.types=["Unknown","Point","LineString","Polygon"],h.prototype.loadGeometry=function(){var t=this._buffer;t.pos=this._geometry;for(var e,i=t.readVarint(),r=t.pos+i,s=1,n=0,a=0,h=0,l=[];t.pos<r;){if(!n){var u=t.readVarint();s=7&u,n=u>>3}if(n--,1===s||2===s)a+=t.readSVarint(),h+=t.readSVarint(),1===s&&(e&&l.push(e),e=[]),e.push(new o(a,h));else{if(7!==s)throw new Error("unknown command "+s);e.push(e[0].clone())}}return e&&l.push(e),l},h.prototype.bbox=function(){var t=this._buffer;t.pos=this._geometry;for(var e=t.readVarint(),i=t.pos+e,r=1,s=0,n=0,a=0,o=1/0,h=-1/0,l=1/0,u=-1/0;t.pos<i;){if(!s){var f=t.readVarint();r=7&f,s=f>>3}if(s--,1===r||2===r)(n+=t.readSVarint())<o&&(o=n),n>h&&(h=n),(a+=t.readSVarint())<l&&(l=a),a>u&&(u=a);else if(7!==r)throw new Error("unknown command "+r)}return[o,l,h,u]},l.prototype.readFeatureValue=function(){for(var t,e,i=this._buffer,r=null,s=i.readVarint(),n=i.pos+s;i.pos<n;)1==(e=(t=i.readVarint())>>3)?r=i.readString():2==e?r=i.readFloat():3==e?r=i.readDouble():4==e||5==e?r=i.readVarint():6==e?r=i.readSVarint():7==e?r=Boolean(i.readVarint()):i.skip(t);return r},l.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._buffer.pos=this._features[t];var e=this._buffer.readVarint()+this._buffer.pos;return new h(this._buffer,e,this.extent,this._keys,this._values)},u.prototype._readLayer=function(){var t=this._buffer,e=t.readVarint(),i=t.pos+e,r=new l(t,i);return t.pos=i,r},u.prototype.parseGeometries=function(){for(var t in this.layers){var e=this.layers[t];e.parsedFeatures=[];for(var i=0,r=e._features.length;i<r;i++){var s=e.feature(i);s.coordinates=s.loadGeometry(),e.parsedFeatures.push(s)}}};class f{constructor(t,e){var i=this;this.id=e.id,this.map=t,this._url=e.url||"",this._sourceMaxZoom=e.sourceMaxZoom||!1,this._debug=e.debug||!1,this.getIDForLayerFeature=e.getIDForLayerFeature||function(t){return t.properties.id||t.properties.Id||t.properties.ID},this._visibleLayers=e.visibleLayers||!1,this._xhrHeaders=e.xhrHeaders||{},this._clickableLayers=e.clickableLayers||!1,this._filter=e.filter||!1,this._cache=e.cache||!1,this._tileSize=e.tileSize||256,this.tileSize=new google.maps.Size(this._tileSize,this._tileSize),this.style=e.style||function(t){var e={};switch(t.type){case 1:e.fillStyle="rgba(49,79,79,1)",e.radius=5,e.selected={fillStyle:"rgba(255,255,0,0.5)",radius:6};break;case 2:e.strokeStyle="rgba(136, 86, 167, 1)",e.lineWidth=3,e.selected={strokeStyle:"rgba(255,25,0,0.5)",lineWidth:4};break;case 3:e.fillStyle="rgba(188, 189, 220, 0.5)",e.strokeStyle="rgba(136, 86, 167, 1)",e.lineWidth=1,e.selected={fillStyle:"rgba(255,140,0,0.3)",strokeStyle:"rgba(255,140,0,1)",lineWidth:2}}return e},this.mVTLayers=[],this._tilesDrawn=[],this._visibleTiles=[],this._selectedFeatures=[],e.selectedFeatures&&this.setSelectedFeatures(e.selectedFeatures),this.map.addListener("zoom_changed",(()=>{i._zoomChanged()}))}getTile(t,e,i){var r=this.drawTile(t,e,i);return this._setVisibleTile(r),r.canvas}releaseTile(t){}_zoomChanged(){this._resetVisibleTiles(),this._cache||this._resetMVTLayers()}_resetMVTLayers(){this.mVTLayers=[]}_deleteVisibleTile(t){delete this._visibleTiles[t]}_resetVisibleTiles(){this._visibleTiles=[]}_setVisibleTile(t){this._visibleTiles[t.id]=t}drawTile(t,e,i){var r=this.getTileId(e,t.x,t.y),s=this._tilesDrawn[r];return s||(s=this._createTileContext(t,e,i),this._xhrRequest(s),s)}_createTileContext(t,e,i){var r=this.getTileId(e,t.x,t.y),s=this._createCanvas(i,r),n=this._getParentId(r);return{id:r,canvas:s,zoom:e,tileSize:this._tileSize,parentId:n}}_getParentId(t){var e=!1;if(this._sourceMaxZoom){var i=this.getTileObject(t);if(i.zoom>this._sourceMaxZoom){var r=i.zoom-this._sourceMaxZoom,s=i.zoom-r,n=i.x>>r,a=i.y>>r;e=this.getTileId(s,n,a)}}return e}_createCanvas(t,e){const i=t.createElement("canvas");return i.width=this._tileSize,i.height=this._tileSize,i.id=e,i}getTileId(t,e,i){return[t,e,i].join(":")}getTileObject(t){var e=t.split(":");return{zoom:e[0],x:e[1],y:e[2]}}_xhrRequest(t){var e=this,i=t.parentId||t.id,r=this.getTileObject(i),s=this._url.replace("{z}",r.zoom).replace("{x}",r.x).replace("{y}",r.y),n=new XMLHttpRequest;for(var a in n.onload=function(){if("200"==n.status&&n.response)return e._xhrResponseOk(t,n.response);e._drawDebugInfo(t)},n.open("GET",s,!0),this._xhrHeaders)n.setRequestHeader(a,this._xhrHeaders[a]);n.responseType="arraybuffer",n.send()}_xhrResponseOk(t,e){if(this.map.getZoom()==t.zoom){var i=new Uint8Array(e),r=new u(new(n())(i));this._drawVectorTile(r,t)}}_setTileDrawn(t){this._cache&&(this._tilesDrawn[t.id]=t)}deleteTileDrawn(t){delete this._tilesDrawn[t]}_resetTileDrawn(){this._tilesDrawn=[]}_drawVectorTile(t,e){if(this._visibleLayers)for(var i=0,r=this._visibleLayers.length;i<r;i++){var s=this._visibleLayers[i];if(t.layers[s]){var n=t.layers[s];this._drawVectorTileLayer(n,s,e)}}else for(var s in t.layers)n=t.layers[s],this._drawVectorTileLayer(n,s,e);e.vectorTile=t,this._drawDebugInfo(e),this._setTileDrawn(e)}_drawVectorTileLayer(t,e,i){this.mVTLayers[e]||(this.mVTLayers[e]=this._createMVTLayer(e)),this.mVTLayers[e].parseVectorTileFeatures(this,t.parsedFeatures,i)}_createMVTLayer(t){var i={getIDForLayerFeature:this.getIDForLayerFeature,filter:this._filter,style:this.style,name:t};return new e(i)}_drawDebugInfo(t){if(this._debug){var e=this.getTileObject(t.id),i=this._tileSize,r=this._tileSize,s=t.canvas.getContext("2d");s.strokeStyle="#000000",s.fillStyle="#FFFF00",s.strokeRect(0,0,i,r),s.font="12px Arial",s.fillRect(0,0,5,5),s.fillRect(0,r-5,5,5),s.fillRect(i-5,0,5,5),s.fillRect(i-5,r-5,5,5),s.fillRect(i/2-5,r/2-5,10,10),s.strokeText(t.zoom+" "+e.x+" "+e.y,i/2-30,r/2-10)}}onClick(t,e,i){this._multipleSelection=i&&i.multipleSelection||!1,i=this._getMouseOptions(i,!1),this._mouseEvent(t,e,i)}onMouseHover(t,e,i){this._multipleSelection=!1,i=this._getMouseOptions(i,!0),this._mouseEvent(t,e,i)}_getMouseOptions(t,e){return{mouseHover:e,setSelected:t.setSelected||!1,toggleSelection:void 0===t.toggleSelection||t.toggleSelection,limitToFirstVisibleLayer:t.limitToFirstVisibleLayer||!1}}_mouseEvent(t,e,i){if(t.pixel&&t.latLng){e=e||function(){};var r=i.limitToFirstVisibleLayer||!1,s=this.map.getZoom(),n=a.getTileAtLatLng(t.latLng,s),o=this.getTileId(n.z,n.x,n.y),h=this._visibleTiles[o];if(h){t.tileContext=h,t.tilePoint=a.fromLatLngToTilePoint(this.map,t);for(var l=this._clickableLayers||Object.keys(this.mVTLayers)||[],u=l.length-1;u>=0;u--){var f=l[u],c=this.mVTLayers[f];if(c&&(t=c.handleClickEvent(t),this._mouseSelectedFeature(t,e,i),r&&t.feature))break}}}}_mouseSelectedFeature(t,e,i){if(i.setSelected){var r=t.feature;r?i.mouseHover?r.selected||r.select():i.toggleSelection?r.toggle():r.selected||r.select():i.mouseHover&&this.deselectAllFeatures()}e(t)}deselectAllFeatures(){var t=this.map.getZoom(),e=[];for(var i in this._selectedFeatures){var r=this._selectedFeatures[i];if(r){r.setSelected(!1);var s=r.getTiles();for(var n in s)this.deleteTileDrawn(n),this.getTileObject(n).zoom==t&&(e[n]=!0)}}this.redrawTiles(e),this._selectedFeatures=[]}featureSelected(t){this._multipleSelection||this.deselectAllFeatures(),this._selectedFeatures[t.featureId]=t}featureDeselected(t){delete this._selectedFeatures[t.featureId]}setSelectedFeatures(t){t.length>1&&(this._multipleSelection=!0),this.deselectAllFeatures();for(var e=0,i=t.length;e<i;e++){var r=t[e];for(var s in this._selectedFeatures[r]=!1,this.mVTLayers)this.mVTLayers[s].setSelected(r)}}isFeatureSelected(t){return null!=this._selectedFeatures[t]}getSelectedFeatures(){var t=[];for(var e in this._selectedFeatures)t.push(this._selectedFeatures[e]);return t}setFilter(t,e){for(var i in e=void 0===e||e,this._filter=t,this.mVTLayers)this.mVTLayers[i].setFilter(t);e&&this.redrawAllTiles()}setStyle(t,e){for(var i in e=void 0===e||e,this.style=t,this.mVTLayers)this.mVTLayers[i].setStyle(t);e&&this.redrawAllTiles()}setVisibleLayers(t,e){e=void 0===e||e,this._visibleLayers=t,e&&this.redrawAllTiles()}getVisibleLayers(){return this._visibleLayers}setClickableLayers(t){this._clickableLayers=t}redrawAllTiles(){this._resetTileDrawn(),this.redrawTiles(this._visibleTiles)}redrawTiles(t){for(var e in t)this.redrawTile(e)}redrawTile(t){this.deleteTileDrawn(t);var e=this._visibleTiles[t];e&&e.vectorTile&&(this.clearTile(e.canvas),this._drawVectorTile(e.vectorTile,e))}clearTile(t){t.getContext("2d").clearRect(0,0,t.width,t.height)}setUrl(t,e){e=void 0===e||e,this._url=t,this._resetMVTLayers(),e&&this.redrawAllTiles()}}})(),r})()));